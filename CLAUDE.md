# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

GADS (Grid Automation Device System) is an open-source device farm platform for remote device control and Appium test execution on mobile devices (iOS/Android) and smart TVs (Samsung Tizen OS, LG WebOS). It serves as a self-hosted alternative to AWS Device Farm and Firebase Test Lab.

The platform consists of two main components:
1. **Hub** - A web interface for remote device control and provider management
2. **Provider** - Handles device setup and makes devices available for remote access

## Architecture Structure

- `main.go` - Entry point with Cobra CLI commands for `hub` and `provider` components
- `hub/` - Contains all hub-related functionality including authentication, device management, API routes, and web UI serving
- `provider/` - Contains all provider-related functionality for device detection, setup, and management
- `common/` - Shared models and database utilities used by both hub and provider
- `docs/` - Documentation files including API documentation generated by Swag
- `hub-ui/` - React-based web interface (proprietary, obfuscated component)

## Common Development Commands

### Building the Application

**Standard build (without UI):**
```bash
go build .
```

**Build with embedded UI (requires pre-built UI files in hub-ui/build/):**
```bash
go build -tags ui .
```

**Cross-compilation for different platforms:**
```bash
# Windows
GOOS=windows GOARCH=amd64 go build -tags ui -o GADS.exe .

# macOS
GOOS=darwin GOARCH=amd64 go build -tags ui -o GADS .

# Linux
GOOS=linux GOARCH=amd64 go build -tags ui -o GADS .
```

### Running Tests

```bash
# Run all tests
go test ./...

# Run tests with coverage
go test -cover ./...

# Run specific package tests
go test ./hub/auth/...
```

### Development Workflow

1. **Install dependencies:**
```bash
go mod tidy
```

2. **Generate Swagger documentation:**
```bash
swag init -g hub/hub.go -o docs
```

3. **Run Hub component:**
```bash
go run . hub --port=10000 --mongo-db=localhost:27017
```

4. **Run Provider component:**
```bash
go run . provider --nickname=Provider1 --hub=http://localhost:10000 --mongo-db=localhost:27017
```

### Database Requirements

- MongoDB v6.0+ is required
- Local development instance can be started with:
```bash
docker run -d --restart=always --name mongodb -p 27017:27017 mongo:6.0
```

## Component-Specific Development

### Hub Development
- Main entry: `hub/hub.go`
- Authentication: `hub/auth/`
- API routes: `hub/router/`
- Device management: `hub/devices/`

Key features:
- Gin web framework for HTTP handling
- JWT-based authentication system
- WebSocket connections for real-time device control
- Appium Grid compatibility
- Multi-workspace and tenant management

### Provider Development
- Main entry: `provider/provider.go`
- Device handling: `provider/devices/` (iOS, Android, Tizen, WebOS implementations)
- Configuration: `provider/config/`
- HTTP routes: `provider/router/`

Key features:
- Platform-specific device detection and setup
- Appium server management per device
- Video streaming (MJPEG, WebRTC experimental)
- Device health monitoring
- Resource file management

## Testing Guidelines

- Unit tests are colocated with implementation files (`*_test.go`)
- Use `github.com/stretchr/testify` for assertions
- Mock external dependencies where possible
- Test both positive and negative cases
- Maintain high test coverage for critical authentication and device management functions

## Code Quality Standards

- Follow existing code patterns and structures
- Use structured logging with `logrus`
- Handle errors appropriately with contextual messages
- Maintain thread safety with mutexes for shared resources
- Document exported functions with Godoc comments
- Follow 12-factor app principles for configuration management